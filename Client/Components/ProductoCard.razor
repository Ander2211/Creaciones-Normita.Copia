@namespace Client.Components
@using Shared.Models

<div class="bg-white rounded-xl shadow-md overflow-hidden
            hover:shadow-xl transform hover:scale-105 hover:-translate-y-1
            transition duration-300 hover:ring-2 hover:ring-pink-300">
    <div class="aspect-[3/4] w-full overflow-hidden relative">
        @if (Producto.ImagenUrls != null && Producto.ImagenUrls.Count > 0)
        {
            <img src="@(Producto.ImagenUrls.ElementAtOrDefault(currentIndex) ?? string.Empty)"
                 alt="@Producto.Nombre"
                 class="w-full h-full object-cover transition" />

            <!-- Prev / Next -->
                        <button @onclick="Prev" aria-label="Anterior" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 rounded-full p-2 shadow-md hover:bg-white">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16">
                                    <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0m3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z"/>
                                </svg>
                        </button>
                        <button @onclick="Next" aria-label="Siguiente" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 rounded-full p-2 shadow-md hover:bg-white">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right-circle-fill" viewBox="0 0 16 16">
                                    <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5z"/>
                                </svg>
                        </button>

            <!-- Thumbnails -->
            <div class="absolute left-1/2 -translate-x-1/2 bottom-2 flex gap-2">
                @for (var i = 0; i < Producto.ImagenUrls.Count; i++)
                {
                    var thumb = Producto.ImagenUrls[i];
                    <button @onclick="() => SelectIndex(i)" class="w-10 h-10 rounded overflow-hidden border-2 @(i==currentIndex?"border-pink-400":"border-white/60")">
                        <img src="@thumb" alt="thumb-@i" class="w-full h-full object-cover" />
                    </button>
                }
            </div>
        }
        else
        {
            <img src="" alt="sin imagen" class="w-full h-full object-cover" />
        }
    </div>

    <div class="p-4 flex flex-col justify-between h-44">
        <div>
            <h3 class="text-lg font-semibold text-gray-800">@Producto.Nombre</h3>
            <p class="text-gray-600 text-sm line-clamp-2">@Producto.Descripcion</p>
        </div>
        <div class="mt-3 flex items-center justify-between">
            <span class="bg-pink-200 text-gray-900 text-sm font-medium px-3 py-1 rounded-lg">
                $@Producto.Precio
            </span>
            <p class="text-xs text-gray-500 mt-1">+ Env√≠o internacional</p>
        </div>

        <button @onclick="() => OnCotizar.InvokeAsync(Producto)"
                class="mt-2 bg-pink-200 text-gray-900 px-4 py-2 rounded-lg text-sm font-medium 
                       hover:bg-purple-200 transition">
            Cotizar
        </button>
    </div>
</div>

@code {
    [Parameter] public Producto Producto { get; set; } = default!;
    [Parameter] public EventCallback<Producto> OnCotizar { get; set; }
    private int currentIndex = 0;

    protected override void OnParametersSet()
    {
        // reset index when product changes
        currentIndex = 0;
    }

    private void Prev()
    {
        if (Producto?.ImagenUrls == null || Producto.ImagenUrls.Count == 0) return;
        currentIndex = (currentIndex - 1 + Producto.ImagenUrls.Count) % Producto.ImagenUrls.Count;
    }

    private void Next()
    {
        if (Producto?.ImagenUrls == null || Producto.ImagenUrls.Count == 0) return;
        currentIndex = (currentIndex + 1) % Producto.ImagenUrls.Count;
    }

    private void SelectIndex(int i)
    {
        if (Producto?.ImagenUrls == null) return;
        if (i >= 0 && i < Producto.ImagenUrls.Count) currentIndex = i;
    }
}
